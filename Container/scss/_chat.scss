// This file contains the styles that add/override the chat-widget.css generated by Svelte, so that the design match the style guide of

// https://lidl-styleguide.sovanta.com/#/c/conversationalinterfaces

// ============================================================
//	Style classes of CAKE css-framework
// ============================================================

.badge {
  @at-root a#{&},
  &-link-style {
    @include plain-hover-focus {
      text-decoration: none;
    }
  }
}

// part of badge mixin
.badge-primary {
  color: color-yiq($primary);
  background-color: $primary;

  @at-root a#{&},
  &-link-style {
    @include hover-focus {
      color: color-yiq($primary);
      background-color: darken($primary, 10%);
    }

    &:focus,
    &.focus {
      outline: 0;
      box-shadow: 0 0 0 $badge-focus-width rgba($primary, .5);
    }
  }
}

// ============================================================
//	App.svelte
// ============================================================

#sit-chat-widget {
  box-sizing: border-box;
  max-width: $chat-widget-max-width;
  height: $chat-widget-height;
  margin: 0 auto;
  color: $chat-widget-color;
  @include border-top-radius($chat-widget-border-radius);
  background-color: $chat-widget-bg-color;
  box-shadow: $chat-widget-box-shadow;

  // header
  > header {
    @include border-top-radius($chat-widget-border-radius);
    flex: 0 0 $chat-widget-header-height;
    height: $chat-widget-header-height;
    padding: $chat-widget-header-padding;
    font-weight: $chat-widget-header-font-weight;
    line-height: $chat-widget-header-font-line-height;
    color: $chat-widget-header-color;
    background-color: $chat-widget-header-bg-color;

    .content {
      position: relative;
      height: 100%;

      .bot-avatar {
        width: $chat-widget-header-logo-size;
        height: $chat-widget-header-logo-size;
        margin-right: $chat-widget-header-logo-margin;
        background-color: $chat-widget-header-logo-bg-color;
        border: $chat-widget-header-logo-border;
      }
    }

    .close {
      flex-shrink: 0;
      width: $chat-widget-header-close-icon-size;
      height: $chat-widget-header-close-icon-size;
      margin: $chat-widget-header-close-margin;
      cursor: pointer;
      background: $chat-widget-header-close-background;
    }
  }

  .spacer {
    display: none;
  }

  // content
  .messages {
    @include chatbot-hide-scrollbars;

    // Browserfix - Firefox - https://bugzilla.mozilla.org/show_bug.cgi?id=748518
    // using `::after` element instead of padding bottom.
    &::after {
      display: block;
      height: $chat-widget-content-padding-x;
      content: "";
    }

    // new msg alert
    .btn-scroll-down {
      @extend .hyphens;
      position: absolute;
      right: 0;
      bottom: $chat-widget-msg-alert-bottom;
      max-width: $chat-widget-msg-alert-max-width;
      padding: $chat-widget-msg-alert-padding;
      @include border-left-radius($chat-widget-msg-alert-border-radius);
      font-size: $chat-widget-msg-alert-font-size;
      line-height: 1.2;
      color: $chat-widget-msg-alert-color;
      background-color: $chat-widget-msg-alert-bg-color;
      border-color: $chat-widget-msg-alert-border-color;
      border-right-width: 0;
      box-shadow: $chat-widget-msg-alert-box-shadow;

      + div:not(.chips-container) {
        margin-top: $chat-widget-content-padding-x;
      }
    }
    .chips-container:nth-child(2) {
      margin-top: 0;
    }
  }

  // footer
  > footer {
    @extend .input-group;
    height: $chat-widget-footer-height;
    padding: 0;
    background-color: $chat-widget-bg-color;
  }

  .user-input {
    @extend .form-control;
    @include border-radius(0);
    height: 100%;
    padding: $chat-widget-footer-user-input-padding;
    border: 0 none;

    &,
    &:hover,
    &:focus {
      &:not(:disabled):not(:invalid):not(.is-invalid) {
        border-top: $chat-widget-footer-user-input-border-top;
      }
    }
  }

  .btn-send {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 3;
    width: $chat-widget-footer-btn-send-size;
    height: $chat-widget-footer-btn-send-size;
    color: $chat-widget-footer-icon-color-disabled;

    &.active {
      color: $chat-widget-footer-icon-color;
      cursor: pointer;

      &:hover {
        color: $chat-widget-footer-icon-color-hover;
      }
    }
    .icon {
      width: $chat-widget-footer-icon-size;
      height: $chat-widget-footer-icon-size;
    }
  }

  // ============================================================
  //  Chip.svelte
  // ============================================================

  .chips-container {
    margin-top: $chat-widget-chip-grid-margin;
  }

  .chip {
    @extend .badge;
    @extend .badge-primary;
    @extend .badge-link-style;
    @extend .badge-primary-link-style;
    margin: $chat-widget-chip-grid-margin 0 0 $chat-widget-chip-grid-margin;
  }

  // ============================================================
  //  Image.svelte
  // ============================================================

  .image-container {
    @include border-radius($chat-widget-image-border-radius);
    position: relative;
    width: $chat-widget-image-container-width;
    height: 0;
    padding-bottom: $chat-widget-image-ratio-height;
    margin: $chat-widget-image-container-margin;
    box-shadow: $chat-widget-image-container-box-shadow;

    img {
      @include border-radius($chat-widget-image-border-radius);
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  }

  // ============================================================
  //  ButtonList.svelte
  // ============================================================

  .btn-list-container {
    @include border-radius($chat-widget-btn-list-container-border-radius);
    @extend .text-break;
    min-width: $chat-widget-card-min-width;
    max-width: $chat-widget-card-max-width;
    margin: $chat-widget-btn-list-margin;
    color: $chat-widget-btn-list-container-color;
    background-color: $chat-widget-btn-list-container-bg-color;
    box-shadow: $chat-widget-btn-list-container-shadow;

    header {
      @include markdown-content;
      padding: $chat-widget-btn-list-header-padding;
    }
    .content {
      @extend .list-group;
      @extend .list-group-flush;
      @include chatbot-list-group-item;
    }
  }

  // ============================================================
  //  Card.svelte (aka the Slider)
  // ============================================================

  .card-container {
    @extend .text-break;
    margin: $chat-widget-vertical-space-between-components 0 0;
    background-color: $chat-widget-slider-bg-color;

    .scroll-btn {
      top: 50%;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      width: $chat-widget-slider-btn-widht;
      height: $chat-widget-slider-btn-height;
      background-color: $chat-widget-slider-btn-bg-color;
      transform: translateY(-50%);

      &.left {
        @include border-right-radius($chat-widget-slider-btn-border-radius);
      }
      &.right {
        @include border-left-radius($chat-widget-slider-btn-border-radius);
      }
    }
    // We need some right margin to show the shadow of the last section. Since the last section's
    // margin-right is NOT taken into account, we do follow an idea from
    // https://itnext.io/horizontal-overflow-with-flexbox-css-64f530495303
    .scrollable {
      @include chatbot-hide-scrollbars;

      &::after {
        flex: 0 0 $chat-widget-slider-gutter; // last value defines the desired padding-right of .scrollable (for example: depends on box-shadow of section)
        content: "";
      }

      section {
        @include border-radius($chat-widget-slider-section-border-radius);
        min-width: $chat-widget-card-min-width;
        max-width: $chat-widget-card-max-width;
        margin: $chat-widget-slider-section-margin;
        font-size: $chat-widget-slider-font-size;
        color: $chat-widget-slider-color;
        background-color: $chat-widget-slider-section-bg-color;
        box-shadow: $chat-widget-slider-box-shadow;

        &:first-child {
          margin-left: $chat-widget-slider-gutter;
        }

        &:last-of-type {
          margin-right: 0;
        }

        header {
          padding-bottom: $chat-widget-slider-img-ratio-height;
          background-position: center;
          background-size: cover;
        }
      }

      .content {
        padding: $chat-widget-slider-content-padding;
      }

      .title-row .title,
      .title-row .figure,
      .subtitle {
        overflow-x: initial;
        text-overflow: initial;
        @extend .hyphens;
      }

      .title-row {
        .title {
          font-size: $chat-widget-slider-title-font-size;
          font-weight: $chat-widget-slider-title-weight;
        }
        .figure {
          display: none;
        }
      }

      .subtitle {
        margin-top: $chat-widget-slider-subtitle-margin-top;
        font-size: $chat-widget-slider-subtitle-font-size;
        font-weight: $chat-widget-slider-subtitle-weight;
      }

      .description {
        margin-top: $chat-widget-slider-description-margin-top;

        p:last-child {
          margin-bottom: 0;
        }
      }

      footer {
        @extend .list-group;
        @extend .list-group-flush;
        @include chatbot-list-group-item;
      }

      &:only-child {
        max-width: $chat-widget-slider-single-max-width;

        .content {
          padding: $chat-widget-slider-single-padding;
        }

        .title-row {
          .title {
            font-size: $chat-widget-slider-single-title-font-size;
          }
        }

        .subtitle {
          margin-top: 0;
        }
      }
    }
  }

  // ============================================================
  //  Text.svelte
  // ============================================================

  .text-container {
    @include markdown-content;
    @extend .text-break;
    margin: $chat-widget-vertical-space-between-components 0 0 0;

    span {
      @include border-radius($chat-widget-msg-border-radius);
      padding: $chat-widget-msg-padding;
      box-shadow: $chat-widget-msg-box-shadow;
    }

    &.out {
      margin-left: $chat-widget-receiver-margin;

      span {
        @include border-bottom-right-radius(0);
        margin-right: $chat-widget-transmitter-margin;
        color: $chat-widget-msg-outgoing-color;
        background-color: $chat-widget-msg-outgoing-bg-color;
      }
    }

    &.in {
      margin-right: $chat-widget-receiver-margin;

      span {
        @include border-bottom-left-radius(0);
        margin-left: $chat-widget-transmitter-margin;
        color: $chat-widget-msg-incoming-color;
        background-color: $chat-widget-msg-incoming-bg-color;

        .typing {
          box-sizing: border-box;
          display: inline-block;
          width: $chat-widget-typing-dimension;
          height: $chat-widget-typing-dimension;
          margin-right: 0;
          background-color: $chat-widget-typing-bg-default;
          @include border-radius(50%);

          &.typing-1 {
            animation: typing 2s infinite;
          }

          &.typing-2 {
            animation: typing 2s 250ms infinite;
          }

          &.typing-3 {
            animation: typing 2s 500ms infinite;
          }
        }
      }
    }
  }

  @keyframes typing {
    0%,
    75%,
    100% {
      background-color: $chat-widget-typing-bg-default;
      transform: translate(0, $chat-widget-typing-animation-up-down) scale($chat-widget-typing-animation-scale);
    }

    25% {
      background-color: $chat-widget-typing-bg-animated;
      transform: translate(0, -$chat-widget-typing-animation-up-down) scale(1);
    }
  }

  // ============================================================
  //  Icon
  // ============================================================
  .arrow {
    display: block;
    width: $chat-widget-btn-list-icon-size;
    height: $chat-widget-btn-list-icon-size;
  }
  .arrow,
  .left {
    &.bright {
      background: $chat-widget-icon-bg-left-bright;
    }
  }
  .right {
    background: $chat-widget-icon-bg-right;

    &.bright {
      background: $chat-widget-icon-bg-right-bright;
    }
  }
}
