<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <base href="../../../_assets/themes/Cake/">

    <script>
      // Check that the globalThemes variable is availabe, otherwise theme-switch will not work
      var globalThemes = ["Cake", "Lidl", "Schwarz"];
      var defaultTheme = globalThemes;
      if (typeof globalThemes !== "undefined" && window.location.search) {

        var themeHandlerName = "theme";
        var theme = localStorage.getItem (themeHandlerName) || defaultTheme;

        // Check if query-parameter exists in url
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has(themeHandlerName)) {
          theme = urlParams.get(themeHandlerName);
        }

        // Check if theme is valid, otherwise set the default theme
        if (!globalThemes.includes (theme)) {
          theme = defaultTheme;
        }

        // Update if theme has changed, or first theme needs to be set
        if (!localStorage.getItem (themeHandlerName)) {
          localStorage.setItem (themeHandlerName, theme);
        } else if (localStorage.getItem (themeHandlerName) !== theme) {
          localStorage.setItem (themeHandlerName, theme);
          location.reload ();
        }
      } else {
        var theme = globalThemes;
      }

      // Create and adjust base-path to set correct theme-location
      if (typeof defaultTheme === "undefined") {
        var defaultTheme = "${ config.defaultTheme }";
      }
      var theme = localStorage.getItem ("theme") || defaultTheme;
      var baseElement = document.getElementsByTagName ("base") [0];
      var baseElementHref = baseElement.getAttribute ('href');
      baseElement.href = baseElementHref.substr (0, baseElementHref.lastIndexOf('/', baseElementHref.lastIndexOf('/') - 1) + 1) + theme + "/";
    </script>

    <!-- Theme independent overall styling -->
    <link rel="stylesheet" href="../../css/chat-widget.min.css" />
    <!-- Theme -->
    <link rel="stylesheet" href="css/chat-cake.min.css" />

    <title>Chatbot</title>
  </head>
  <body>
    <div id="chat-widget-wrapper"></div>

    <!-- polyfills IE need for Promise, fetch API, ... -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=fetch%2Ces6"></script>

    <!-- from: https://github.com/facebook/regenerator -->
    <script src="../../js/runtime.js"></script>

    <!-- chat widget -->
    <script src="../../js/chat-widget-legacy.min.js"></script>

    <script>
      // chatbot
      var iconSend;
      if (theme === "Lidl") {
        iconSend = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M55.06 2.27L3.66 27.02c-1.71.82-1.42 3.35.44 3.76l20.62 4.51 4.51 20.62c.41 1.86 2.93 2.15 3.76.44L57.73 4.94c.82-1.71-.96-3.49-2.67-2.67zM7.57 28.46L49.7 8.18l-24.2 24.2-17.93-3.92zm23.97 23.97L27.62 34.5l24.2-24.2-20.28 42.13z"/><path d="M20.29 38.29c-.2-.2-.51-.2-.71 0L5.29 52.59c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l12.88-12.88c.98-.98.98-2.56 0-3.54zM9.01 42.77l2.47-2.47c.98-.98.98-2.56 0-3.54-.2-.2-.51-.2-.71 0l-3.89 3.89c-.2.2-.2.51 0 .71l1.41 1.41c.21.2.52.2.72 0zM22.27 45.95l-7.34 7.34c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l5.92-5.92c.98-.98.98-2.56 0-3.54a.501.501 0 00-.7 0z"/></svg>'
      } else if (theme === "Schwarz") {
        iconSend = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M55.06 2.27L3.66 27.02c-1.71.82-1.42 3.35.44 3.76l20.62 4.51 4.51 20.62c.41 1.86 2.93 2.15 3.76.44L57.73 4.94c.82-1.71-.96-3.49-2.67-2.67zM7.57 28.46L49.7 8.18l-24.2 24.2-17.93-3.92zm23.97 23.97L27.62 34.5l24.2-24.2-20.28 42.13z"/><path d="M20.29 38.29c-.2-.2-.51-.2-.71 0L5.29 52.59c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l12.88-12.88c.98-.98.98-2.56 0-3.54zM9.01 42.77l2.47-2.47c.98-.98.98-2.56 0-3.54-.2-.2-.51-.2-.71 0l-3.89 3.89c-.2.2-.2.51 0 .71l1.41 1.41c.21.2.52.2.72 0zM22.27 45.95l-7.34 7.34c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l5.92-5.92c.98-.98.98-2.56 0-3.54a.501.501 0 00-.7 0z"/></svg>'
      } else {
        iconSend = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M55.06 2.27L3.66 27.02c-1.71.82-1.42 3.35.44 3.76l20.62 4.51 4.51 20.62c.41 1.86 2.93 2.15 3.76.44L57.73 4.94c.82-1.71-.96-3.49-2.67-2.67zM7.57 28.46L49.7 8.18l-24.2 24.2-17.93-3.92zm23.97 23.97L27.62 34.5l24.2-24.2-20.28 42.13z"/><path d="M20.29 38.29c-.2-.2-.51-.2-.71 0L5.29 52.59c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l12.88-12.88c.98-.98.98-2.56 0-3.54zM9.01 42.77l2.47-2.47c.98-.98.98-2.56 0-3.54-.2-.2-.51-.2-.71 0l-3.89 3.89c-.2.2-.2.51 0 .71l1.41 1.41c.21.2.52.2.72 0zM22.27 45.95l-7.34 7.34c-.2.2-.2.51 0 .71l1.41 1.41c.2.2.51.2.71 0l5.92-5.92c.98-.98.98-2.56 0-3.54a.501.501 0 00-.7 0z"/></svg>'
      }

      new ChatWidget({
        target: document.getElementById('chat-widget-wrapper'),
        props: {
          endpoint: 'https://dev.vca.lidl/api/v2/chat/key/lidl-vca-demo/',
          settings: {
            cardScrollDistance: 200,
            newMessages: 'â†“ Neue Nachrichten',
            locale: 'de-DE',
            header: `
              <div style="display: flex; align-items: center;">
                <img
                  src="images/logo.svg"
                  alt="Logo"
                  class="bot-avatar" />
                Sir Chatalot the second
              </div>
              <a class="close" onclick="alert('Implement click handler to close widget!')" />`,
            iconSend: iconSend
          },
        },
      });
    </script>

  </body>
</html>
